# 访问者模式

一个作用于某对象结构中个元素的操作，不改变元素的类的前提下，定义作用于元素的操作。

书中例子，由于男女思维的不同，对待同一件事情可能会有不同的态度。

第一版代码位于 `version1` 文件夹下：

- `person.h`，人的虚基类，其中的对事情的态度为虚方法
- `men.h`，继承 person.h，实现具体的男人对事情的态度
- `women.h`，继承 person.h，实现具体的女人对事情的态度
- `main.cpp`，编译执行

但是 `if else` 很多，如果增加其它的状态，那么两个类都需要增加分支，所以可以把分支写成类。

1. 应该将状态抽象为类，类中有两个方法，分别是男人的和女人的。
2. 而后具体的人实现访问方法，访问方法传入状态类，调用状态类的方法。
3. 实现访问者类，类中有一个容器添加具体的人，传入一个状态，类中的容器中的人对状态执行响应

代码位于 `version2` 文件夹。但好像又是之前的 `bug`，左脚蹬右脚，右脚踩左脚螺旋上天的代码。之后一起修复。

---

访问者模式适用于数据结构相对稳定的系统，将数据结构和作用在结构上的操作耦合解开，操作集合可以自由的演化。**适合：稳定的数据结构、易于变化的算法**。因为算法的增添很容易，使数据对象的添加变得困难。相反，如果数据结构不稳定，经常变化，总有新的数据对象加入和删除，就不要用访问者模式。比如，男人和女人的操作，适合访问者模式，数据对象就两个，佷稳定。

大多时候不需要访问者模式，如果需要，就是真的需要了。